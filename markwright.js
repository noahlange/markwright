(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b():'function'==typeof define&&define.amd?define([],b):'object'==typeof exports?exports.markwright=b():a.markwright=b()})('undefined'==typeof self?this:self,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s='./src/components/Markwright.tsx')}({"./src/components/Content.tsx":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('react');class e extends d.Component{componentWillReceiveProps(a){this.props.flow&&this.props.content!==a.content&&this.props.flow.relayout()}render(){return d.createElement('div',{ref:this.props.observe,className:`mw-content mw-content-${this.props.id}`,dangerouslySetInnerHTML:{__html:this.props.content}})}}b.default=e},"./src/components/Markwright.tsx":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('react'),e=c('./src/components/Section.tsx');class f extends d.Component{constructor(){super(...arguments),this.state={counts:[1],dump:!1,sections:[]},this.addPage=(a,b)=>{const c=this.state.counts;c[a]=b,this.setState({counts:c})}}makeSections(a){const b=[],c=[],d=/^# (.+)/gim;let e=a,f=d.exec(e);for(;f;){const a=f[1];c.push({title:a,index:f.index}),f=d.exec(e)}for(const{title:d,index:f}of c.reverse())b.push({title:d,content:e.slice(f)}),e=e.slice(0,f);this.setState({sections:b.reverse()})}componentDidMount(){this.makeSections(this.props.content)}componentWillReceiveProps(a){this.props.content!==a.content&&this.makeSections(a.content)}render(){return d.createElement('div',{className:'mw'},this.state.sections.length?this.state.sections.map(({title:a,content:b},c)=>d.createElement(e.default,{idx:c,content:b,addPage:this.addPage,key:c,title:a,start:this.state.counts.reduce((d,a,b)=>d+(b<c?a:0),0)||0})):d.createElement(e.default,{idx:0,addPage:this.addPage,key:0,title:'',start:0,content:this.props.content}))}}b.default=f},"./src/components/Page.tsx":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('react'),e=()=>d.createElement('div',{className:'mw-column'}),f=({num:a})=>d.createElement('div',{className:'mw-pagination'},a),g=({title:a})=>d.createElement('div',{className:'mw-header'},a),h=({id:a,content:b})=>d.createElement('div',{className:'mw-footnote'},d.createElement('sup',null,a),' ',b),i=({footnotes:a})=>{const b=`mw-footnotes ${a.length?'':'mw-empty'}`,c=a.map(([a,b],c)=>d.createElement(h,{key:c,id:a,content:b}));return d.createElement('div',{className:'mw-body'},d.createElement('div',{className:'mw-contents'},d.createElement(e,null),d.createElement('div',{className:'mw-column-separator'}),d.createElement(e,null)),d.createElement('div',{className:b},c))};class j extends d.Component{render(){let a=[];if(this.page&&this.props.flow)for(let b=0;b<this.props.footnotes.length;b++){const c=this.props.footnotes[b],d=this.props.flow.regions[b];if(this.page.contains(d)&&c){a=a.concat(c);continue}}return d.createElement('div',{className:`mw-page mw-page-${this.props.num}`,ref:(a)=>this.page=a},d.createElement(g,{title:this.props.title}),d.createElement(i,{footnotes:a}),d.createElement(f,{num:this.props.num}))}}b.default=j},"./src/components/Pages.tsx":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('react'),e=c('./src/components/Page.tsx');b.default=function({pages:a,title:b,flow:c,footnotes:f,start:g}){const h=[];for(let j=0;j<a;j++)h.push(d.createElement(e.default,{num:j+g+1,key:j+g,footnotes:f,flow:c,title:b}));return d.createElement(d.Fragment,null,h)}},"./src/components/Section.tsx":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('markdown-it'),e=c('markdown-it-attrs'),f=c('react'),g=c('shortid'),h=c('./src/markdown/container.ts'),i=c('./src/markdown/footnote.ts'),j=c('./src/components/Content.tsx'),k=c('./src/components/Pages.tsx'),l=/\s*<div class="footnote footnote-(\d)">([\s\S]*?)<\/div>/gi,m=({id:a})=>{const b=`.mw-content-${a} { flow-into: ${a}; }`,c=`.mw-section-${a} .mw-column { flow-from: ${a}; }`;return f.createElement('style',{type:'text/css'},b+c)};class n extends f.Component{constructor(){super(...arguments),this.mounted=!1,this.flow=null,this.id=g.generate().toLowerCase(),this.state={footnotes:{},html:'',md:new d({html:!0,typographer:!0}).use(e).use(i.default).use(h.default),pages:1},this.overset=(a)=>{if(a.target.overset)this.setState({pages:this.state.pages+1}),this.props.addPage(this.props.idx,this.state.pages);else{const b=a.target.firstEmptyRegionIndex;0==b%2&&this.setState({pages:Math.ceil(b/2)},()=>this.flow.relayout())}},this.observe=(a)=>{const b=new MutationObserver(()=>{const a=document.getNamedFlows()[this.id];a&&this.mounted&&(this.flow=a,a.addEventListener('regionoversetchange',this.overset),b.disconnect(),this.forceUpdate())});a&&b.observe(a,{attributes:!0})}}stripEscapes(a){let b=a;const c={};for(let b=l.exec(a);null!==b;)c[b[1]]=b[2],b=l.exec(a);return b=b.replace(l,(a,b)=>`<sup class="footnote-${this.id} footnote-${b}">${b}</sup>`),{html:b,footnotes:c}}generateFootnotes(a){const b=[];if(this.flow){const c=this.flow.regions;for(const d of Object.keys(a)){const e=c.findIndex((a)=>a.querySelector(`.footnote-${this.id}.footnote-${d}`)),f=[d,a[d]];b[e]=b[e]?b[e].concat([f]):[f]}}else return Object.keys(a).map((b)=>[b,a[b]]);return b}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const a=this.state.md.render(this.props.content),{html:b,footnotes:c}=this.stripEscapes(a),d=this.generateFootnotes(c);return f.createElement('div',{className:`mw-section mw-section-${this.id}`},f.createElement(m,{id:this.id}),f.createElement(k.default,{title:this.props.title,start:this.props.start,pages:this.state.pages,footnotes:d,flow:this.flow}),f.createElement(j.default,{id:this.id,flow:this.flow,observe:this.observe,content:b}))}}b.default=n},"./src/markdown/container.ts":function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});const d=c('markdown-it/lib/common/utils');b.default=function(a){a.renderer.rules.container=function(a,b,c,e,f){const g=a[b],h=g.info?d.unescapeAll(g.info).trim():'';let j,k,i,l;h&&(j=h.split(/\s+/g)[0]);const m=c.highlight?c.highlight(g.content,j)||d.escapeHtml(g.content):d.escapeHtml(g.content);return h?(k=g.attrIndex('class'),i=g.attrs?g.attrs.slice():[],0>k?i.push(['class',`block block-${j}`]):i[k][1]+=' '+`block block-${j}`,l={attrs:i},`<div${f.renderAttrs(l)}>${m}</div>\n`):`<div class="block ${f.renderAttrs(g)}">${m}</div>\n`},a.block.ruler.before('fence','container',function(a,b,c,d){let e,f,g,h,i,j,k,l=!1,m=a.bMarks[b]+a.tShift[b],n=a.eMarks[b];if(4<=a.sCount[b]-a.blkIndent)return!1;if(m+3>n)return!1;if(e=a.src.charCodeAt(m),58!==e)return!1;if(g=m,m=a.skipChars(m,e),f=m-g,3>f)return!1;if(k=a.src.slice(g,m),h=a.src.slice(m,n),0<=h.indexOf(String.fromCharCode(e)))return!1;if(d)return!0;i=b;do{if(i++,i>=c)break;if(m=g=a.bMarks[i]+a.tShift[i],n=a.eMarks[i],m<n&&a.sCount[i]<a.blkIndent)break;if(a.src.charCodeAt(m)!==e)continue;if(4<=a.sCount[i]-a.blkIndent)continue;if(m=a.skipChars(m,e),m-g<f)continue;if(m=a.skipSpaces(m),m<n)continue;l=!0;break}while(!0);return f=a.sCount[b],a.line=i+(l?1:0),j=a.push('container','div',0),j.info=h,j.content=a.getLines(b+1,i,f,!0),j.markup=k,j.map=[b,a.line],!0},{alt:['paragraph','reference','blockquote','list']})}},"./src/markdown/footnote.ts":function(a,b){'use strict';Object.defineProperty(b,'__esModule',{value:!0}),b.default=function(a){const b=a.helpers.parseLinkLabel;a.renderer.rules.footnote_inline=function(a,b){const c=a[b];return`<div class="footnote footnote-${c.meta.id+1}">${c.content}</div>`},a.inline.ruler.after('image','footnote_inline',function(a,c){const d=a.pos,e=a.posMax;let f;const g=[];if(d+2>=e)return!1;if(94!==a.src.charCodeAt(d))return!1;if(91!==a.src.charCodeAt(d+1))return!1;const h=d+2,i=b(a,d+1);if(0>i)return!1;if(!c){a.env.footnotes||(a.env.footnotes={}),a.env.footnotes.list||(a.env.footnotes.list=[]);const b=a.env.footnotes.list.length;a.md.inline.parse(a.src.slice(h,i),a.md,a.env,g),f=a.push('footnote_inline','',0),f.meta={id:b},f.content=a.src.slice(h,i),a.env.footnotes.list[b]={tokens:g}}return a.pos=i+1,a.posMax=e,!0})}},"markdown-it":function(a){a.exports=require('markdown-it')},"markdown-it-attrs":function(a){a.exports=require('markdown-it-attrs')},"markdown-it/lib/common/utils":function(a){a.exports=require('markdown-it/lib/common/utils')},react:function(a){a.exports=require('react')},shortid:function(a){a.exports=require('shortid')}})});